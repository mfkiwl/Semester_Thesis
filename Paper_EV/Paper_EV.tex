% This is one possible realization of the official FSD Microsoft Word template. The title page has to be filled in in Microsoft Word environment and saved as a PDF file. Note, that in the header and footer the name of the author and the thesis topic have to be provided. 
%
% Compile Template in following order:
%
% pdflatex Paper_EV
% makeindex Paper_EV.nlo -s nomencl.ist -o Paper_EV.nls (Table of Symbols)
% makeindex Paper_EV.acn -s Paper_EV.ist -t Paper_EV.alg -o Paper_EV.acr (Table of Acronyms)
% makeindex Paper_EV.glo -s Paper_EV.ist -t Paper_EV.glg -o Paper_EV.gls
% pdflatex Paper_EV
% pdflatex Paper_EV
%
% TODO:
% - Title page: Dr. -> Dr. ir.
%
%#################################################################################
%#################################################################################
%#################################################################################

% Preamble
\documentclass[11pt, a4paper, twoside]{report}

% Define page layout
\usepackage[
 left=2.5cm,
 right=2.5cm,
 top=2.5cm,
 bottom=3cm]
{geometry}

% Package for defining the default font size
% We use Helvetica as an alternative to Arial
\usepackage{helvet}
\renewcommand{\familydefault}{\sfdefault}
%alternatively one can use Arial package and compile with XeLaTEX
%\usepackage{fontspec}
%\setmainfont{Arial}

% Set line spacing to 1.15pt
\renewcommand{\baselinestretch}{1.15}

% Set spacing between paragraphs to be 10pt
\setlength{\parskip}{10pt}

% Set paragraph intendation (here 0pt, no intendation)
\setlength{\parindent}{0pt}

% Package for estimating the last page
\usepackage{pageslts}

% Package for bold symbols and letters
\usepackage{bm}

% Package for equations and math. symbols
\usepackage{amsmath}
\usepackage{amssymb}

% Package and settings for adding header/footer
\usepackage{fancyhdr}

% Set style for pages with arabic numbering 
% This block prints only the chapter number and the chapter name, not the word "Chapter"
%\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{\ \thechapter. \ #1}}{}}
% Clear current page style 
\fancyhf{}
% Head (11 pt font size and 12 pt line spacing)
\fancyhf[HRE,HLO]{\includegraphics[width=2.5cm]{figs/fsd}}
\fancyhf[HRO,HLE]{\fontsize{11}{12}\selectfont \leftmark}
% Foot (11 pt font size and 12 pt line spacing)
\fancyhf[FRE,FLO]{\fontsize{11}{12}\selectfont Design, Implem. and Eval. of an INDI Controller for a Nano-Quadrotor\\\vspace*{0.1cm}Evghenii Volodscoi}
\fancyhf[FLE,FRO]{\fontsize{11}{12}\selectfont Page \thepage \thinspace / \lastpageref{LastPages}}
% Line settings
\renewcommand{\headrulewidth}{0.1pt}	%upper line
\renewcommand{\footrulewidth}{0.1pt}	%lower line

% Set style for pages with roman numbering 
\fancypagestyle{fancy_beginning}{%
%\pagestyle{fancy}
% Clear current page style 
\fancyhf{}%
% Head
\fancyhf[HRE,HLO]{\includegraphics[width=2.5cm]{figs/fsd}}%
\fancyhf[HRO,HLE]{\fontsize{11}{12}\selectfont \leftmark}%
% Foot
\fancyhf[FRE,FLO]{\fontsize{11}{12}\selectfont Design, Implem. and Eval. of an INDI Controller for a Nano-Quadrotor\\\vspace*{0.1cm}Evghenii Volodscoi}%
\fancyhf[FLE,FRO]{\fontsize{11}{12}\selectfont Page \thepage}%
% Line settings
\renewcommand{\headrulewidth}{0.1pt}%	%upper line
\renewcommand{\footrulewidth}{0.1pt}%	%lower line
}

% Package for inserting titel page
\usepackage{pdfpages}

% Package for changing distance between sections
\usepackage{titlesec} 

% Package for setting up the caption options of figures
\usepackage{subcaption}

% Package prevents placing floats before a section (for not mooving figures)
\usepackage{float}

% TODO
% Package for using acronyms 
%\usepackage[printonlyused]{acronym}
%\renewcommand\acsfont{\textnormal}	% Set non-bold font of the acronym units

% This patch removes the insertion of \addvspace to both the LoF and the LoT; the cause of the additional gap between entries on a per-chapter basis
\usepackage{etoolbox}% http://ctan.org/pkg/etoolbox
\makeatletter
% \patchcmd{<cmd>}{<search>}{<replace>}{<succes>}{<failure>}
\patchcmd{\@chapter}{\addtocontents{lof}{\protect\addvspace{10\p@}}}{}{}{}% LoF
\patchcmd{\@chapter}{\addtocontents{lot}{\protect\addvspace{10\p@}}}{}{}{}% LoT
\makeatother

% Set chapter font size and spacing
\newcommand{\chapfnt}{\fontsize{14}{19}}
\titleformat{\chapter}
{\normalfont\chapfnt\bfseries}{\thechapter}{1em}{\chapfnt} 	% set font size
\titlespacing{\chapter}{0cm}{-7mm}{0cm}					% set spacing

% Set section font size (13pt) and spacing
\newcommand{\secfnt}{\fontsize{13}{19}}
\titleformat{\section}
{\normalfont\secfnt\bfseries}{\thesection}{1em}{}
\titlespacing*{\section}{0cm}{0.3cm}{0cm}					% set spacing

% Package for edditing TOC, LOF and LOT
\usepackage[titles]{tocloft}

% Package for setting itemization/description parameters like indentation of items
\usepackage{enumitem}

% Package for acronyms
\usepackage[acronym, automake, nopostdot, nogroupskip]{glossaries}
\setlength{\LTleft}{-0.15cm}			% left justified
\renewcommand*{\arraystretch}{1.4}		% vertical distance between entries, default is 1
% List
\newacronym{INDI}{INDI}{Incremental Nonlinear Dynamic Inversion}
\newacronym{NED}{NED}{North East Down}
\newacronym{NDI}{NDI}{Nonlinear Dynamic Inversion}
% Make gls
\renewcommand*\entryname{Acronym}
\makeglossaries

% Package for setting up the list of symbols
%https://tex.stackexchange.com/questions/112884/how-to-achieve-nomenclature-entries-like-symbol-description-dimension-and-uni
\usepackage{nomencl,etoolbox,ragged2e,siunitx}
%
\newcommand{\DimensUnits}[2]{\makebox[1em]{#1}\makebox[4em]{#2\hfill}\ignorespaces}
\newcommand{\insertnomheaders}{\item[\bfseries Symbol]\DimensUnits{}{\textbf{Unit}}\textbf{Description}}
%
\renewcommand\nomgroup[1]{%
  \item[\large\bfseries
  \ifstrequal{#1}{A}{Acronyms}{%
  \ifstrequal{#1}{B}{Latin Letters}{%
  \ifstrequal{#1}{G}{Greek Letters}{%
  \ifstrequal{#1}{S}{Indices}{% 
  \ifstrequal{#1}{U}{Subscripts}{%   
  \ifstrequal{#1}{X}{Other Symbols}{}}}}}}]
  \insertnomheaders
  }
%
\renewcommand*{\nompreamble}{\markboth{\nomname}{\nomname}}
% parbox - Description
\newcommand{\nomdescr}[1]{\parbox[t]{10cm}{\RaggedRight #1}}
\newcommand{\nomwithdim}[5]{\nomenclature[#1]{#2}{\DimensUnits{}{#5}\nomdescr{#3}}}
%
\makenomenclature


%#################################################################################%#################################################################################%#################################################################################

\begin{document}

% Activate roman page numbering
\pagenumbering{roman}

% Insert title page
\includepdf[pages={1}]{figs/Title_page.pdf}

%Insert empty page after title page
\newpage\null\thispagestyle{empty}\newpage


% For some reason fisrt chapter has a different vert. spacing from the top, so we add additional 0.8cm, starred command makes sure it will not be suppressed at the beginning or at the end of the page
\vspace*{-0.8cm}
\section*{Statutory Declaration}
I, Evghenii Volodscoi, declare on oath towards the Institute of Flight System Dynamics of Technische Universität München, that I have prepared the present Semester Thesis independently and with the aid of nothing but the resources listed in the bibliography.
\\
\\
This thesis has neither as-is nor similarly been submitted to any other university.
\bigskip
\\
\\
Garching, 

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy_beginning}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\chaptermark{Statutory Declaration}

%Insert empty page after statutory declaration section
\newpage\null\thispagestyle{empty}\newpage

\section*{Kurzfassung} \label{sec:kurzfassung}
% Start cursive block
\begin{itshape}
Deutsche Kurzfassung der Arbeit.
\end{itshape}


% Add Abstract chapter to the same page as Kurzfassung
{\let\clearpage\relax\section*{Abstract}}
% Start cursive block
\begin{itshape}
English abstract of the thesis.
\end{itshape}

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy_beginning}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\chaptermark{Abstract}

%Insert empty page after abstract page
\newpage\null\thispagestyle{empty}\newpage



% Add Table of Contents 
\setlength{\cftbeforechapskip}{0.2cm}			% space before chapters
\renewcommand\cftchapafterpnum{\vskip-0.4cm}	% space after chapters
\renewcommand\cftsecafterpnum{\vskip-0.4cm}		% space after sections
\renewcommand\cftsubsecafterpnum{\vskip-0.4cm}	% space after subsections	
\renewcommand{\cftchapfont}{\normalfont}		% set normal font, not bold
%\titleformat{\section}{\fontsize{14}{19}}	 	% ?
 
\renewcommand*\contentsname{Table of Contents}  % Change the defaulf name "Contents" to "Table of Contents"  
\tableofcontents								% Generate Table of Contents

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy_beginning}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\chaptermark{Table of Contents}

%Insert empty page after table of contents
\newpage\null\thispagestyle{empty}\newpage

% Add List of Figures  
\renewcommand{\cftfigfont}{Figure }				% Add "Figure" to the LOF
\renewcommand\cftfigaftersnum{:} 				% Put ":" after the figure num 
\setlength{\cftfigindent}{0pt}					% Remove left indent 
\setlength\cftbeforefigskip{-0.2cm}				% Space between figures 
\addtocontents{lof}{\vspace*{10pt}}			    % Set distance between LOF title and list
\listoffigures
%\setlength{\cftbeforeloftitleskip}{0cm}		% ? 
%\setlength\cftafterloftitleskip{-2cm}


% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy_beginning}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\chaptermark{List of Figures}

%Insert empty page after table the list of figures
\newpage\null\thispagestyle{empty}\newpage

% Add List of Tables
\renewcommand{\cfttabfont}{Table }				% Add "Figure" to the LOF
\renewcommand\cfttabaftersnum{:} 				% Put ":" after the figure num 
\setlength{\cfttabindent}{0pt}					% Remove left indent
\setlength\cftbeforetabskip{-0.2cm}				% Space between tables
\addtocontents{lot}{\vspace*{10pt}}			    % Set distance between LOT title and list
\listoftables{}

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy_beginning}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\chaptermark{List of Tables}

%Insert empty page after the list of tables 
\newpage\null\thispagestyle{empty}\newpage

% Print table of acronyms
\printglossary[type=\acronymtype, title={Table of Acronyms}, nonumberlist, style=longheader]

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy_beginning}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\chaptermark{Table of Acronyms}

%Insert empty page after table of acronyms
\newpage\null\thispagestyle{empty}

% Add Table of Symbols
%\chapter*{Table of Symbols} \label{sec:symbols}
\mbox{}
\nomwithdim{B}{\( F \)}{Force}{L}{$N$}
\nomwithdim{B}{\( g \)}{Gravitational acceleration}{}{$m/s^2$}
\nomwithdim{G}{\( \alpha \)}{Angle of attack}{}{$rad$}
\nomwithdim{G}{\( \zeta \)}{Damping of a linear second order system}{}{--}
\nomwithdim{S}{\( m \)}{Variable related to pitch moment}{}{}
\nomwithdim{S}{\( W \)}{Wind}{}{}
\renewcommand{\nomname}{Table of Symbols}
\printnomenclature[6em]

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy_beginning}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\chaptermark{Table of Symbols}

%Insert empty page after table of symbols
\newpage\null\thispagestyle{empty}\newpage

% Beginning of the core text 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Activate arabic page numbering from here on
\pagenumbering{arabic}

% Delete the word "Chapter" leaving only the number of the chapter
\titleformat{\chapter}
{\normalfont\chapfnt\bfseries}{\thechapter}{1em}{\chapfnt} 	% set font size
\titlespacing*{\chapter}{0cm}{-7mm}{0cm}					% set spacing

% Set subsection font size (11pt) and spacing
\newcommand{\ssecfnt}{\fontsize{11}{14}}
\titleformat{\subsection}
{\normalfont\ssecfnt\bfseries}{\thesubsection}{1em}{}
\titlespacing*{\subsection}{0cm}{-0cm}{0cm}					% set spacing

% Activate default fancy design (chapter number, chapter)
\pagestyle{fancy} 
\renewcommand{\chaptermark}[1]{\markboth{\ \thechapter \ #1}{}}

% Change separator in the figure and table captures from "." to "-"
\renewcommand{\thefigure}{\thechapter-\arabic{figure}}
\renewcommand{\thetable}{\thechapter-\arabic{table}}



\chapter{Introduction} \label{cha:introduction}

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy}
\chaptermark{Introduction}

\section{Motivation} \label{sec:motivation}

\section{Contribution of the Thesis} \label{sec:contribution_ofthe_thesis}

\section{Structure of the Thesis} \label{sec:structure_ofthe_thesis} 



\chapter{Theoretical Background} \label{cha:theoretical_background}

...

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy}
\chaptermark{Theoretical Background}

\section{Dynamic Equations of Motion of an Aircraft} \label{sec:eqs_motion}

In this section general equations of motion of an aircraft are presented.  

For the derivation of the equation of motion the aircraft system will be assumed to be a rigid body. Such a rigid body system can be described uniquely by 12 states. Note that by taking in account additional effects, such propulsion system dynamics, multi-body dynamics etc., the number of required state variables will increase. 

Additionally to the rigid body assumption, it is also assumed that the earth is flat and non-rotating and the reference point of the force vector corresponds to the center of gravity of the body. Thus, the linear momentum equation is written as
\begin{equation}
	\begin{split}
		\sum (\bm{F}^G)_B = m \cdot \Big[ (\bm{\dot{v}}^G)_{B} + (\bm{\omega}^{OB})\times(\bm{v}^R)_{B} \Big]
		\label{eq:lin_momentum}
	\end{split}
\end{equation}
where $\sum(\bm{F}^G)_B \in \mathbb{R}^{3 \times 1}$ is the sum of the external forces acting on the system and applied to the center of gravity $G$, $m$ the mass of the body, $(\bm{\dot{v}}^G)_{B} \in \mathbb{R}^{3 \times 1}$ the linear acceleration of the point $G$, $(\bm{\omega}^{OB}) \in \mathbb{R}^{3 \times 1}$ the angular velocity of the body-fixed frame ($B$) with respect to the \acrfull{NED} ($O$) coordinate frame. Subscript $B$ denotes that all variables are specified in the body-fixed coordinate frame.

The rotational motion of a body is described with the angular momentum. To derive it, additionally to the assumptions made above it is also considered that the mass and the mass distribution are quasistationary, meaning $\frac{d}{dt}m=0$ and $\frac{d}{dt}(I)_B=0$ respectively?. $(I)_B$ is the inertia tensor of the body defined in the body-fixed frame. Thus, the angular momentum is
\begin{equation}
	\begin{split}
		\sum (\bm{M}^G)_B = (\bm{I}^G)_B \cdot (\bm{\dot{\omega}}^{OB}) + (\bm{\omega}^{OB}) \times \Big[(\bm{I}^G)_B \cdot (\bm{\omega}^{OB})\Big]
		\label{eq:ang_momentum}
	\end{split}
\end{equation}
where $\sum (\bm{M}^G)_B \in \mathbb{R}^{3 \times 1}$ is the sum of the external moments acting on the system around the center of gravity $G$, 

The remaining two equations, that are necessary to fully describe the rigid body are the attitude differential equation and the position differential equation. The attitude differential equation describes the relationship between angular rates $p, q, r$ and derivatives of the Euler angles $\dot{\Phi}, \dot{\Theta}, \dot{\Psi}$ leading to
\begin{equation}
	\begin{bmatrix}
		\dot{\Phi}\\
		\dot{\Theta}\\
		\dot{\Psi}
	\end{bmatrix} =
	\begin{bmatrix}
    	1 & \sin\Phi\tan\Theta & \cos\Phi\tan\Theta \\
    	0 & \cos\Phi & -\sin\Phi \\
    	0 & \frac{\sin\Phi}{\cos\Theta} & \frac{\cos\Phi}{\cos\Theta}
    \end{bmatrix}_B
    \begin{bmatrix}
		p\\
		q\\
		r
	\end{bmatrix}_B
	\label{eq:attitude_diff_eq}
\end{equation}

There are different options to represent the position differential equation. Here, for completeness only, it is written as a simple relationship between the change of the position coordinates in the local \acrshort{NED} frame and the velocity coordinates of the same frame
\begin{equation}
	\begin{bmatrix}
		\dot{x}\\
		\dot{y}\\
		\dot{z}
	\end{bmatrix}_O =
	\begin{bmatrix}
		\dot{V_N}\\
		\dot{V_E}\\
		\dot{V_D}
	\end{bmatrix}_O
	\label{eq:position_diff_eq}
\end{equation}

The above presented Equations (\ref{eq:lin_momentum})-(\ref{eq:position_diff_eq}) can be used to represent a motion of a general aircraft. $\sum(\bm{F}^G)_B$ and $\sum (\bm{M}^G)_B$ are sums of the external forces and moments acting on the aircraft. These could be the aerodynamic forces and moments caused by the air flow, propulsion forces and moments, forces caused by the gravitation etc.. The detailed modelling of external forces and moments is presented in chapter (...Simulink).

\section{Nonlinear Dynamic Inversion} \label{sec:ndi}

In this subsection, the \acrfull{NDI} method is explained. The \acrshort{NDI} approach is based on feedback linearization and is also called \textit{Input-Output Linearization}. Often, such type of controllers is involved in tracking control tasks, where objective is to track some desired trajectory \cite{Slotine}. To derive it, consider the following nonlinear system
\begin{subequations}
	\begin{align}
		&\bm{\dot{x}} = \bm{f(x)} + \bm{G(x)}\bm{u} \label{eq:nonlin_sys1} \\
		&\bm{y} = \bm{h(x)} \label{eq:nonlin_sys2}
	\end{align}
	\label{eq:nonlin_sys}
\end{subequations}
where $\bm{x} \in \mathbb{R}^{n \times 1}$ is the state vector, $\bm{u} \in \mathbb{R}^{m \times 1}$ the input vector, $\bm{y} \in \mathbb{R}^{m \times 1}$ the system vector, $\bm{f(x)} \in \mathbb{R}^{n \times 1}$ and $\bm{h(x) \in \mathbb{R}^{m \times 1}}$ nonlinear vector fields and $\bm{G} \in \mathbb{R}^{m \times n}$ an input matrix. Note that the system presented in Equations (\ref{eq:nonlin_sys}) is affine in the input, which is not allways fulfilled. Using a state transformation $\bm{z = \phi(x)}$, the affine system from Equation \ref{eq:nonlin_sys1} can be transformed into normal (canonical) representation. 

The core idea behind the input-output linearization method is to find a direct relationship between the desired system output and the control input. After the relationship is found it is inverted to generate the control law. To derive this relationship the output $\bm{y}$ is differentiated until the input $\bm{u}$ appears
\begin{equation}
	\begin{split}
		\dot{\bm{y}} &=  \frac{\partial\bm{y}}{\partial t} = \frac{\partial\bm{h(x)}}{\partial t} \frac{\partial\bm{x}}{\partial t} = \frac{\partial\bm{h(x)}}{\partial t} \dot{\bm{x}} = \nabla\bm{h(x)} [\bm{f(x)} + \bm{G(x)}\bm{u}] \\
		&= \nabla\bm{h(x)} \bm{f(x)} + \nabla\bm{h(x)} \bm{G(x)}\bm{u}] = L_{\bm{f}} \bm{h(x)} + L_{\bm{G}} \bm{h(x) u} 
		\label{eq:dy}
	\end{split}
\end{equation}

In Equation (\ref{eq:dy}) $L_{\bm{f}} \bm{h(x)}$ is called Lie derivative of $\bm{h(x)}$ with respect to $\bm{f(x)}$. The Lie derivative is defined as $L_{\bm{f}} \bm{h(x)} = \nabla\bm{h(x)} \bm{f(x)}$ with $\nabla$ being the Nabla operator. Thus, it represents a directional derivative of $\bm{h(x)}$ along the direction of the vector field $\bm{f(x)}$. If the term $L_{\bm{G}} \bm{h(x)}$ is nonzero, the relationship between input and output is
\begin{equation}
	\begin{split}
		\dot{\bm{y}} = L_{\bm{f}} \bm{h(x)} + L_{\bm{G}} \bm{h(x) u} 
		\label{eq:dy_u_rel}
	\end{split}
\end{equation}

Now Equation (\ref{eq:dy_u_rel}) can be used to formulate the control law by solving it for $\bm{u}$ and substituting $\dot{\bm{y}}$ with $\bm{\nu}$
\begin{equation}
	\begin{split}
		\bm{u} = L_{\bm{G}}\bm{h(x)}^{-1} (\bm{\nu} - L_{\bm{f}}\bm{h(x)})
		\label{eq:u_control_law}
	\end{split}
\end{equation}
The variable $\bm{\nu}$ is called an \textit{equivalent input} and represents the desired output of the system. 

In the example provided above the input-output relationsip was found after the first differentiation of the output $\bm{y}$. But if after the first differentiation the term $L_{\bm{G}}\bm{h(x)}$ is zero, output $\bm{y}$ has to be differentiated until the Lie derivative with respect to $\bm{G}$ is nonzero. The $i$-th derivative of the output is then
\begin{equation}
	\begin{split}
		\frac{\partial^i\bm{y}}{\partial t} = \frac{\partial^i\bm{h(x)}}{\partial t} = L_{\bm{f}}^i \bm{h(x)} + L_{\bm{G}} L_{\bm{f}}^{i-1} \bm{h(x) u}
		\label{eq:dy_i}
	\end{split}
\end{equation}
with $i$ being the \textit{relative degree} of the system. Using Equation (\ref{eq:dy_i}) to formulate the control law, leads to the following expression for the control input $\bm{u}$
\begin{equation}
	\begin{split}
		\bm{u} = L_{\bm{G}} L_{\bm{f}}^{i-1} \bm{h(x)}^{-1} (\bm{\nu} - L_{\bm{f}}^i\bm{h(x)}) 
		\label{eq:u_control_law_i}
	\end{split}
\end{equation}
Thus, Equation (\ref{eq:u_control_law_i}) applied to Equation (\ref{eq:dy_i}) yields the simple linear relation
\begin{equation}
	\begin{split}
		\bm{y}^i = \bm{\nu}
		\label{eq:u_control_law_i}
	\end{split}
\end{equation}
Despite wide usage (especially in the past of the flight control) of the \acrshort{NDI} method and its numerrous extensions (cite-tag Horn), it also has drawbacks. 

The \acrshort{NDI} method was widely adopted for civil and military aircrafts and has numerous of extensions \cite{Horn}. Nevertheless, it has some drawbacks. The major one is that the control law derived using the \acrshort{NDI} approach is dependent on the full system dynamics model \cite{Sieberling}. As shown in the previous chapter (cite-tag prev-chapter), the equations of motion of an aircraft usually have a complicated nonlinear character. Thus, describing complex physical phenomena often leads to the inconsistency between the real aircraft and its mathematical representation used in the model. As some of those inconsistencies are inevitable there is a need to build a control law which performance is less dependent on the uncertainties of the model. This method is called \acrfull{INDI} and will be discussed in the next section.

\section{Incremental Nonlinear Dynamic Inversion} \label{sec:indi}

The \acrshort{INDI} is an incremental form of the \acrshort{NDI} for which the lack of the accurate system dynamics model does not critically affect the performance of the control algorithm \cite{Silva}. At first the general form of the \acrshort{INDI} is presented in \ref{subsec:indi_general}, then the inner and outer control loops for the Crazyflie quadrotor are derived in \ref{subsec: indi_inner} and \ref{subsec: indi_outer}.

\subsection{General INDI} \label{subsec:indi_general}

The incremental form of the system can be obtained by taking a Taylor series expansion of the Equation \ref{eq:nonlin_sys1}
\begin{equation}
	\begin{split}
		\bm{\dot{x}} &= \bm{f(x_0)} + \bm{G(x_0)}\bm{u_0} \\
		&+ \frac{\partial}{\partial \bm{x}} [\bm{f(x)} + \bm{G(x)}\bm{u}] \bigg|_{\bm{x=x_0,u=u_0}} (\bm{x-x_0}) \\
		&+ \frac{\partial}{\partial \bm{u}} [\bm{f(x)} + \bm{G(x)}\bm{u}] \bigg|_{\bm{x=x_0,u=u_0}} (\bm{u-u_0}) 
		\label{eq:nonlin_sys_taylor}
	\end{split}
\end{equation}
The first term on the right side of the Equation \ref{eq:nonlin_sys_taylor} is $\bm{\dot{x}_0}$. Also, evaluating the differentiation of the third term leads to 
\begin{equation}
	\begin{split}
		\bm{\dot{x}} &= \bm{\dot{x}_0} \\ 
		&+ \frac{\partial}{\partial \bm{x}} [\bm{f(x)} + \bm{G(x)}\bm{u}] \bigg|_{\bm{x=x_0,u=u_0}} (\bm{x-x_0}) \\
		&+ \bm{G(x_0)} (\bm{u-u_0}) 
		\label{eq:nonlin_sys_taylor2}
	\end{split}
\end{equation}
The second term of the Equation \ref{eq:nonlin_sys_taylor2} contains partial derivative with respect to the state vector. Considering very small time increments of the controller loop and applying the \textit{principle of time scale separation} the second term vanishes. This is a valid assumption if the dynamics of the actuators is fast compared with the dynamics of the system. Thus, the Equation \ref{eq:nonlin_sys_taylor2} is further simplified to 
\begin{equation}
	\begin{split}
		\bm{\dot{x}} = \bm{\dot{x}_0} + \bm{G(x_0)} (\bm{u-u_0}) 
		\label{eq:nonlin_sys_indi}
	\end{split}
\end{equation}
Solving Equation \ref{eq:nonlin_sys_indi} for $\bm{u}$ and substituting $\dot{\bm{y}}$ with $\bm{\nu}$, the \acrshort{INDI} control law can be obtained
\begin{equation}
	\begin{split}
		\bm{u} = \bm{u_0} + \bm{G(x_0)^{-1}} (\bm{\nu} - \bm{\dot{x}_0})
		\label{eq:u_control_law_indi}
	\end{split}
\end{equation}
where $\bm{\dot{x}_0}$ is a measurable value from the previous step, $\bm{u_0}$ the control input from the previous step, $\bm{\nu}$ the reference value and $\bm{G(x_0)}$ the control effectiveness matrix. With $\bm{\Delta u=u-u_0}$ the control law from Equation \ref{eq:u_control_law_indi} represents an incremental version of the Equation \ref{eq:u_control_law}. This control law results in computing the increment $\bm{\Delta u}$ of the control input and adding it to the previous value $\bm{u_0}$, instead if computing complete control input command $\bm{u}$. As it is less dependent on the model of the system dynamics, it increases the robustness of the system \cite{Sieberling}.

\subsection{Inner INDI loop for Quadrotor} \label{subsec: indi_inner}

- Derivation of the inner INDI loop (what we want to control, detailed equations).

\subsection{Outer INDI loop for Quadrotor} \label{subsec: indi_outer}

- Derivation of the outer INDI loop (what we want to control, detailed equations).


\chapter{Implementation} \label{cha:implementation}

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy}
\chaptermark{Implementation}

\section{Research Quadrotor} \label{sec:research_quadrotor}

- Some facts about Crazyflie hardware (foto, uC frequency, weight, length)

\section{Implementation in Simulink (Simulink Model)} \label{sec:simulink_model}

\subsection{Purpose} \label{subsec:purpose}

- Estimation of relevant components (Matrices...)\\
- Testing of the PD-gains\\
- Testing the filter

\subsection{Structure} \label{subsec:Structure}
- Force frame from B to O for an easy representation\\
- Show each equation of forces with explaining the made assumptions\\
- Parameters\\
- Actuator dynamics\\
- Filter\\
- Images of the Simulink model

\subsection{Simulation Results} \label{subsec:simulation_results}

\section{Implementation on the Hardware} \label{sec:implementation_on_hardware}

\subsection{Structure of the Code} \label{subsec:structure_ofthe_code}

\subsection{Testing with contact Forces and Moments} \label{subsec:testing_with_fandm}

\chapter{Results} \label{cha:results}

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy}
\chaptermark{Results}



\chapter{Discussion} \label{cha:discussion}

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy}
\chaptermark{Discussion}

\newpage

% Activate and reset roman page numbering
\pagenumbering{roman}
\setcounter{page}{1}

% Add references
\renewcommand\bibname{References}		% Rename Bibliography to References
\bibliographystyle{unsrt}
\bibliography{Lit/Literature}

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy_beginning}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\chaptermark{References}

\chapter*{Appendix} \label{sec:appendix}
% Add Appendix chapter manually to the Table of Contents because Latex doesn't automatically include nonnumerated (...*) chapters/sections to the TOC
\addcontentsline{toc}{chapter}{Appendix}

% Manually add Chapter names to the header (per default not included by Latex)
\thispagestyle{fancy_beginning}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\chaptermark{Appendix}

% End of the document
\end{document}